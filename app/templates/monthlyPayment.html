{% extends "base.html" %} {% block app_content %}
<button
  type="button"
  class="btn btn-primary fixed-button btn-circle btn-xl"
  data-bs-toggle="modal"
  data-bs-target="#myModal"
>
  <iconify-icon icon="typcn:plus" width="50" height="50"></iconify-icon>
</button>
<div id="toolbar">
  <button class="btn btn-warning" onclick="deleteRow()">Delete</button>
</div>
<table
  id="eventsTable"
  data-toggle="table"
  data-height="600"
  data-url="/monthly-records"
  data-pagination="true"
  data-search="true"
  data-show-refresh="true"
  data-show-toggle="true"
  data-show-columns="true"
  data-toolbar="#toolbar"
  aria-describedby="mydesc"
>
  <thead>
    <tr>
      <th data-field="state" data-checkbox="true"></th>
      <th data-field="Name">Name</th>
      <th data-field="Amount">Amount</th>
      <th data-field="Day Payment">Day Payment</th>
      <th data-field="Description">Description</th>
    </tr>
  </thead>
</table>

<div
  class="modal fade"
  id="myModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <form action="/add-monthly" method="post">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Add spending</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <!-- Input field inside the modal -->
          <div class="mb-3">
            <label for="name" class="form-label">Name</label>
            <input
              type="text"
              class="form-control"
              name="name"
              placeholder="Mua đồ ăn"
            />
          </div>
          <div class="mb-3">
            <label for="amount" class="form-label">Amount (x1000)</label>
            <input
              type="number"
              class="form-control"
              name="amount"
              placeholder="200"
            />
          </div>
          <div class="mb-3">
            <label for="type" class="form-label">Monthly payment date</label>
            <input
              type="text"
              class="form-control"
              name="day_payment"
              placeholder="21"
            />
          </div>
          <div class="mb-3">
            <label for="desc" class="form-label">Description</label>
            <input
              type="text"
              class="form-control"
              name="desc"
              placeholder="Mua cho bạn"
            />
          </div>
          <div>
            <select class="form-select" name="payment_type">
              {% for payment_type in payment_types %}
              <option value="{{ payment_type.value }}">
                {{ payment_type.name }}
              </option>
              {% endfor %}
            </select>
            <div class="invalid-feedback">Please select a payment type.</div>
          </div>
        </div>
        <div class="modal-footer">
          <!-- Submit button inside the modal -->
          <button class="btn btn-primary" type="submit">Submit</button>
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Close
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
{% endblock %} {% block styles %} {{ super() }}
<link
  rel="stylesheet"
  href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"
/>
{% endblock %} {% block scripts %} {{ super() }}

<script src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script>
<script>
  var checkedRows = [];

  $("#eventsTable").on("check.bs.table", function (e, row) {
    checkedRows.push({ id: row.Index });
    console.log(checkedRows);
  });

  $("#eventsTable").on("uncheck.bs.table", function (e, row) {
    $.each(checkedRows, function (index, value) {
      if (value.id === row.id) {
        checkedRows.splice(index, 1);
      }
    });
    console.log(checkedRows);
  });

  $("#add_cart").click(function () {
    $("#output").empty();
    $.each(checkedRows, function (index, value) {
      $("#output").append(
        $("<li></li>").text(value.id + " | " + value.name + " | " + value.forks)
      );
    });
  });

  function deleteRow() {
    var formData = new FormData();
    formData.append("row_index", JSON.stringify(checkedRows));
    $.ajax({
      type: "POST",
      url: "/remove-fixed-payment",
      data: formData,
      contentType: false,
      processData: false,
      success: function (response) {
        // Xử lý kết quả nếu cần
        $("#eventsTable").bootstrapTable("refresh");
      },
      error: function (xhr, status, error) {
        // Xử lý lỗi nếu có
        console.error("Request failed with status:", xhr.status);
      },
    });
  }
  // validate
  $(document).ready(function () {
    // Function to validate the form
    function validateForm() {
      var isValid = true;

      // Validate each input field
      $("input[name]").each(function () {
        if ($(this).attr("name") === "desc") {
          return;
        }
        if (!$(this).val()) {
          isValid = false;
          $(this).addClass("is-invalid");
        } else {
          $(this).removeClass("is-invalid");
        }
      });

      return isValid;
    }

    // Form submission handling
    $("form").submit(function (event) {
      if (!validateForm()) {
        event.preventDefault(); // Prevent form submission if validation fails
        // You can also display an error message or handle it in a way that fits your design.
      } else {
        return true;
      }
    });
  });
</script>
{% endblock %}
